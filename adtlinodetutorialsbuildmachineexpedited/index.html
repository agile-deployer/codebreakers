<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Linode ADT Tutorials Build Machine Method | Codebreakers</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Linode ADT Tutorials Build Machine Method" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Agile Deployment Toolkit Linode Build Machine Method" />
<meta property="og:description" content="The Agile Deployment Toolkit Linode Build Machine Method" />
<link rel="canonical" href="https://www.codebreakers.uk/adtlinodetutorialsbuildmachineexpedited/" />
<meta property="og:url" content="https://www.codebreakers.uk/adtlinodetutorialsbuildmachineexpedited/" />
<meta property="og:site_name" content="Codebreakers" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-11T00:00:00-06:00" />
<script type="application/ld+json">
{"datePublished":"2021-01-11T00:00:00-06:00","url":"https://www.codebreakers.uk/adtlinodetutorialsbuildmachineexpedited/","@type":"BlogPosting","headline":"Linode ADT Tutorials Build Machine Method","dateModified":"2021-01-11T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.codebreakers.uk/adtlinodetutorialsbuildmachineexpedited/"},"description":"The Agile Deployment Toolkit Linode Build Machine Method","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://www.codebreakers.uk/feed.xml" title="Codebreakers" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Codebreakers</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Linode ADT Tutorials Build Machine Method</h1><p class="page-description">The Agile Deployment Toolkit Linode Build Machine Method</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-01-11T00:00:00-06:00" itemprop="datePublished">
        Jan 11, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="//categories/#agiledeploymenttoolkit">agiledeploymenttoolkit</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="pre-build-preparations-for-expedited-and-full-builds">PRE BUILD PREPARATIONS FOR EXPEDITED AND FULL BUILDS:</h3>

<p>Before performing an expedited or full build, you need to set up a build machine. The way you do this for Exoscale is as follows:</p>

<hr />

<p>1) If you don’t have an SSH key pair or if you want a specific SSH key pair for your builds, issue the following command:</p>

<p> <br />
 </p>
<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/ssh-keygen -t rsa 
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>Your key will be saved to the indicated file, for example, <strong>/root/.ssh/id_rsa</strong> your path might be different such as <strong>/home/bob/.ssh/id_rsa</strong></p>

<p>Issue the command (for example)</p>

<p> <br />
 </p>
<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/cat /root/.ssh/id_rsa.pub - this will be your &lt;ssh-public-key-substance&gt;
</code></pre></div>  </div>
</blockquote>

<p> <br />
  	 
This will give you your <strong>public</strong> key which you need later so, take a copy of the output that is printed to the screen.</p>

<p> <br />
 <br />
 </p>

<hr />

<p>2) Take a copy of the script: <a href="https://github.com/agile-deployer/agile-infrastructure-build-client-scripts/blob/master/templatedconfigurations/templateoverrides/OverrideScriptLinode.sh">Initial Script</a> and make a stack sript out of it which will look like:</p>

<p><img src="https://www.codebreakers.uk/images/linodetutorial/image1.png" alt="" title="Linode Tutorial Image 1" /></p>

<p> <br />
 <br />
 </p>

<hr />

<p>3) If you want to deploy a machine (debian of ubuntu) using the stack script that you made in 2, you need to populate the following variables in your copy:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BUILDMACHINE_USER=""  (for example agile-deployer)
BUILDMACHINE_PASSWORD=""  (Make sure the password is complex enough to satisfy any strength checks that the OS performs)
BUILDMACHINE_SSH_PORT="" (for example 1056)
LAPTOP_IP=""   (www.whatsmyip.com)
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SSH=\"\"  (the public key that you installed on your laptop as a key pair in 1)
</code></pre></div>  </div>
</blockquote>

<p>Once you deploy your linode using the stack script from 2 it will look something like the following and you need to populate the variables required as you would for any other Stack Script on Linode.</p>

<p><img src="https://www.codebreakers.uk/images/linodetutorial/image2.png" alt="" title="Linode Tutorial Image 2" /></p>

<p><img src="https://www.codebreakers.uk/images/linodetutorial/image3.png" alt="" title="Linode Tutorial Image 3" /></p>

<p><img src="https://www.codebreakers.uk/images/linodetutorial/image4.png" alt="" title="Linode Tutorial Image 4" /></p>

<p><img src="https://www.codebreakers.uk/images/linodetutorial/image5.png" alt="" title="Linode Tutorial Image 5" /></p>

<p>3)  If you are sure that all your variables are set correctly in the stack script you have created, you can now actually deploy a Linode using it and it will install the agile deployment toolkit on it.</p>

<p> <br />
 <br />
 </p>

<hr />

<p>6)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add rules to the "adt-build-machine" security group to allow pinging and your build client to connect.  
</code></pre></div></div>

<p>So you will need to add 2 rules</p>

<p>1) Ping<br />
2) A rule to allow acccess to your build machines defined SSH_PORT from your laptop.<br />
   If you SSH_PORT is 1035 and your build client IP is 111.111.111.111 then you will need a TCP rule with “CIDR 111.111.111.111/32 1035”</p>

<p>You can see in this image that port 1035 is about to be opened up to the ip address of my laptop 111.111.111.111/32</p>

<p><img src="https://www.codebreakers.uk/images/exoscaletutorial/image17.png" alt="" title="Exoscale Tutorial Image 17" /> 
 <br />
 </p>

<hr />

<p>7) You need to spin up a small machine to be your build machine by clicking “Add” on the top right of the GUI. And then follow these steps:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. Select which template you want debian 10 (or later) or ubuntu 20.04 (or later)
2. Select which zone you want to deploy to, for example, CH-GVA-2
3. Select instance type "Tiny" for example
4. Select disk size (50GB)
5. Ignore SSH KEY
6. Make sure your security group "adt-build-machine" is set for this machine and deselect the "default" security group if it is selected. 
7. In the "User Data" area of your VPC machine, paste the entire script that you were left with from 4.
8. Click Create and wait for your machine to build
</code></pre></div>  </div>
</blockquote>

<p>Graphically you can see what I have described in these 8 steps here:</p>

<p> <br />
 <br />
 </p>

<p><img src="https://www.codebreakers.uk/images/exoscaletutorial/image12.png" alt="" title="Exoscale Tutorial Image 12" /><br />
<img src="https://www.codebreakers.uk/images/exoscaletutorial/image13.png" alt="" title="Exoscale Tutorial Image 13" /></p>

<p> <br />
 <br />
 </p>

<hr />

<p>8) Once the machine has built you can access it as follows:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Discover what the machine's IP address is by looking at the Exoscale GUI system for the IP address of the build machine - In this case: 185.19.29.134
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>Now on your laptop issue the command:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -i /root/.ssh/id_rsa -p ${BUILDCLIENT_SSH_PORT} $BUILDCLIENT_USER@&lt;buildclientip&gt;
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>or yours might be:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -i /home/${username}/.ssh/id_rsa -p ${BUILDCLIENT_SSH_PORT} $BUILDCLIENT_USER@&lt;buildclientip&gt;	
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>Once logged in to your build machine</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo su 
[sudo] password for agile-deployer:
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>And then enter your build machine password</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${BUILDMACHINE_PASSWORD}
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>In Graphical form, it looks like this:</p>

<p> <br />
 </p>

<p>Grab your build machine’s IP address (third column)
<img src="https://www.codebreakers.uk/images/exoscaletutorial/image15.png" alt="" title="Exoscale Tutorial Image 15" /></p>

<p> <br />
 </p>

<p>Run through the commands as shown on your laptop to access your build machine</p>

<p> <br />
 </p>

<p><img src="https://www.codebreakers.uk/images/exoscaletutorial/image16.png" alt="" title="Exoscale Tutorial Image 16" /></p>

<hr />


  </div><a class="u-url" href="/adtlinodetutorialsbuildmachineexpedited/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>The main website for the codebreakers project</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
