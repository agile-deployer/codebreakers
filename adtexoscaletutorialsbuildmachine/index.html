<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Exoscale ADT Tutorials Build Machine Method | Codebreakers</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Exoscale ADT Tutorials Build Machine Method" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Agile Deployment Toolkit Exoscale Build Machine Method" />
<meta property="og:description" content="The Agile Deployment Toolkit Exoscale Build Machine Method" />
<link rel="canonical" href="https://www.codebreakers.uk/adtexoscaletutorialsbuildmachine/" />
<meta property="og:url" content="https://www.codebreakers.uk/adtexoscaletutorialsbuildmachine/" />
<meta property="og:site_name" content="Codebreakers" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-01T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2021-11-01T00:00:00-05:00","url":"https://www.codebreakers.uk/adtexoscaletutorialsbuildmachine/","@type":"BlogPosting","headline":"Exoscale ADT Tutorials Build Machine Method","dateModified":"2021-11-01T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.codebreakers.uk/adtexoscaletutorialsbuildmachine/"},"description":"The Agile Deployment Toolkit Exoscale Build Machine Method","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://www.codebreakers.uk/feed.xml" title="Codebreakers" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Codebreakers</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Exoscale ADT Tutorials Build Machine Method</h1><p class="page-description">The Agile Deployment Toolkit Exoscale Build Machine Method</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-11-01T00:00:00-05:00" itemprop="datePublished">
        Nov 1, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="//categories/#agiledeploymenttoolkit">agiledeploymenttoolkit</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="pre-build-preparations-for-expedited-and-full-builds">PRE BUILD PREPARATIONS FOR EXPEDITED AND FULL BUILDS:</h3>

<p>Before performing an expedited or full build, you need to set up a build machine. The way you do this for Exoscale is as follows:</p>

<hr />

<p>1) If you don’t have an SSH key pair or if you want a specific SSH key pair for your builds, issue the following command:</p>

<p> <br />
 </p>
<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/ssh-keygen -t rsa 
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>Your key will be saved to the indicated file, for example, /root/.ssh/id_rsa your path might be different such as /home/bob/.ssh/id_rsa</p>

<p>Issue the command (for example)</p>

<p> <br />
 </p>
<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/cat /root/.ssh/id_rsa.pub - this will be your &lt;ssh-public-key-substance&gt;
</code></pre></div>  </div>
</blockquote>

<p> <br />
  	 
This will give you your <strong>public</strong> key which you need later so, take a copy of the output that is printed to the screen.</p>

<p> <br />
 <br />
 </p>

<hr />

<p>2) Take a copy of the script: 
 </p>
<h4 id="initial-script"><a href="https://github.com/agile-deployer/agile-infrastructure-build-client-scripts/blob/master/templatedconfigurations/templateoverrides/OverrideScript.sh">Initial Script</a></h4>

<p> <br />
 <br />
 </p>

<hr />

<p>3) If you look into the script that you made a copy of in 2, you need to populate the following variables in your copy:
 <br />
 </p>
<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export BUILDMACHINE_USER=""
export BUILDMACHINE_PASSWORD="" 
export BUILDMACHINE_SSH_PORT=""
export LAPTOP_IP=""
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export SSH=\"\"  &amp;nbsp;   &amp;nbsp; 	 Now you need to decide on a username for your build machine, a password for your build machine, a port for your build machine's ssh system and the IP address of your desktop or laptop.
</code></pre></div>  </div>
</blockquote>

<p>If I decide on a username of “agile-deployer” then in the copy that I made in 2, I need to change it as follows:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export BUILDMACHINE_USER="agile-deployer"
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>If I decide on a password of “QQQPPPZZZMMM123098” then in the copy that I made in 2, I need to change it as follows:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export BUILDMACHINE_PASSWORD="QQQPPPZZZMMM123098"
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>If you decide on an SSH_PORT of “1035” then in the copy that I made in 2, I need to change it as follows:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export BUILDMACHINE_SSH_PORT="1035"
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>You need to give the script your laptop IP address. You can do this by going to https://www.whatsmyip.com and so, if your ip address is: “111.111.111.111” and pasting your ip address into your copy as follows:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export LAPTOP_IP="111.111.111.111"
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>The <strong>public</strong> ssh key that you took a copy of in 1 needs to be pasted as follows:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export SSH=\"&lt;ssh-public-key-substance&gt;\"
</code></pre></div>  </div>
</blockquote>

<p> <br />
 </p>

<p>The top part of the copy that you made in 2 will now look like this:</p>

<p> <br />
 </p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash
   
/bin/mkdir /root/logs
   
OUT_FILE="webserver-build-out-`/bin/date | /bin/sed 's/ //g'`"
exec 1&gt;&gt;/root/logs/${OUT_FILE}
ERR_FILE="webserver-build-err-`/bin/date | /bin/sed 's/ //g'`"
exec 2&gt;&gt;/root/logs/${ERR_FILE}

###############################################################################################
# SET THESE FOR YOUR BUILD CLIENT MACHINE
# THIS WILL NOT START A BUILD IT WILL JUST SETUP THE TOOLKIT
# USE THIS IF YOU WANT TO PERFORM AN EXPEDITED OR A FULL BUILD FROM THE COMMAND LINE
# ssh -i &lt;ssh-private-key&gt; -p ${BUILDCLIENT_SSH_PORT} $BUILDCLIENT_USER@&lt;buildclientip&gt;
# $BUILDCLIENT_USER&gt;sudo su
# password:${BUILDCLIENT_PASSWORD}
# cd agile-infrastructure-build-client-scripts/logs
#################################################################################################
export BUILDMACHINE_USER="agile-deployer"
export BUILDMACHINE_PASSWORD="QQQPPPZZZMMM123098" #Make sure any password you choose is strong enough to pass any strength enforcement rules of your OS
export BUILDMACHINE_SSH_PORT="1035"
export LAPTOP_IP="111.111.111.111"
 
/bin/echo "
#BASE OVERRIDES
export SSH=\"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEgqlNPY9uh6SpihNXm/7XGqOKvAcH8Z0Y6pZG9lTIm/PHI5VijIFqs0OzM3DPLFARtut7lojBoKq9ljBmKeVBGX5EkJ5O3CJfEZs9E13e2Qk+7F9wTmoMBG8XY4l/SmD9HddLTS/7Oadg+C4RDxHlSMrl1PSCdzlM14spHCI8rwUntNCUY+fObolqel0829zYDX0oEWzYyoIEUs1847X3cRp9+yZsjqSD5Nw9jacLcWjtdfClEvx5F8ZVm0+s5OLtz9cCf6NkOgYf3KFz+e8qAO/w83Umh5B2Gem1uOxSDtUmzVlRiMTfP6CTSKRnYRnkb97F9RZsmAsG6+g+eKvp root@penguin\" #paste your public key here

The rest of the script will appear below here
</code></pre></div>  </div>
</blockquote>

<p> <br />
 <br />
 </p>

<hr />

<p>4) Take a copy of this entire updated script and keep it safe because you will likely want to use this script multiple times in future deployments remember that anyone who has a copy of this script you have made has enough information to access the build machine you are going to deploy in a minute.</p>

<p> <br />
 <br />
 </p>

<hr />

<p>5) What you need to do now is to use this script to spin up your build machine and you will do this by pasting it into the user data area of your build machine.</p>

<p>I just use the default security group with this toolkit. So, the default security group needs to let through connections to 1035 for the SSH connections.</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In the exoscale default security group, allow through TCP connections to CIDR 0.0.0.0/0 this will allow your laptop to connect to your build machine through port 1035
</code></pre></div>  </div>
</blockquote>

<p> <br />
 <br />
 </p>

<hr />

<p>6) You need to spin up a small machine to be your build machine by clicking “Add” on the top right of the GUI. And then follow these steps:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Select if you want debian 10 (or later) or ubuntu 20.04 (or later)
Select which zone you want to deploy to, for example, CH-GVA-2
Select instance type "Tiny" for example
Select disk size (50GB)
Ignore SSH KEY
Make sure your default security group is set
In the "User Data" area of your VPC machine, paste the entire script that you were left with from 4.
Click Create and wait for your machine to build
</code></pre></div>  </div>
</blockquote>

<p> <br />
 <br />
 </p>

<hr />

<p>7) Once the machine has built you can access it as follows:
 <br />
 </p>
<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Discover what the machine's IP address is by looking at the Exoscale GUI system for the IP address of the build machine - buildclientip &amp;nbsp;   &amp;nbsp;  Now issue the command: &amp;nbsp;   &amp;nbsp; 
ssh -i /root/.ssh/id_rsa -p ${BUILDCLIENT_SSH_PORT} $BUILDCLIENT_USER@&lt;buildclientip&gt; &amp;nbsp;   &amp;nbsp; 	 or yours might be: &amp;nbsp;   &amp;nbsp; 	
ssh -i /home/${username}/.ssh/id_rsa -p ${BUILDCLIENT_SSH_PORT} $BUILDCLIENT_USER@&lt;buildclientip&gt;	 &amp;nbsp;   &amp;nbsp;  Once logged in to your build machine &amp;nbsp;   &amp;nbsp; 
sudo su 
[sudo] password for agile-deployer: &amp;nbsp;   &amp;nbsp; 	 And then enter your build machine password &amp;nbsp;   &amp;nbsp; 	
${BUILDMACHINE_PASSWORD}
</code></pre></div>  </div>
</blockquote>

  </div><a class="u-url" href="/adtexoscaletutorialsbuildmachine/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>The main website for the codebreakers project</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
